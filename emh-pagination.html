<link rel="import" href="./bower_components/polymer/polymer.html"/>
<link rel="import" href="./bower_components/paper-menu/paper-menu.html"/>
<link rel="import" href="./bower_components/paper-item/paper-item.html"/>
<link rel="import" href="./bower_components/paper-button/paper-button.html"/>
<link rel="import" href="./bower_components/iron-icons/iron-icons.html"/>
<link rel="import" href="./bower_components/iron-icon/iron-icon.html"/>
<link rel="import" href="./bower_components/paper-icon-button/paper-icon-button.html"/>
<link rel="import" href="./bower_components/iron-flex-layout/iron-flex-layout.html"/>
        
<dom-module id="emh-pagination">
  <template>
    <style>
      :host {
        display: block;
        --paper-icon-button: { width: 64px; height: 64px; }
      }
      paper-item.emh-pagination {
        float: left;
      }
      paper-button.emh-pagination {
        float: left;
      }
      .flex {
        @apply(--layout-horizontal);
      }
      
    </style>
    <div class="container flex">
      <paper-icon-button icon="icons:first-page" on-tap="prev" raised></paper-icon-button>
      <paper-menu selected="{{current}}" selected-attribute="page" id="emh-pagination-row">
        <!--hidden item take place 0 so, first item will be 1 
                <paper-item class="paper-pagination" page="0" hidden="true"></paper-item>-->
        <template is="dom-repeat" items="[[pages]]" restamp="true">
          <paper-item raised class="paper-pagination"  hidden$="[[item.hidden]]"  page="[[item.page]]">[[item.page]]</paper-item>
        </template>
      </paper-menu>
      <paper-icon-button icon="icons:last-page" on-tap="next" raised>next</paper-icon-button>
    </div>
  </template>

  <script>
    Polymer({

      is: 'emh-pagination',

      properties: {
        pageSize: {
          type: Number
        },
        total: {
          type: Number
        },
        pages: {
          type: Array,
          readOnly: true,
          computed: '_calculatePages(pageSize,total,currentPage)'
        },
        rangeSize: {
          type: Number,
          value: 10
        },
        currentPage: {
          type: Number,
          value: 1,
          reflectToAttribute: true,
          notify: true
        },
        offset: {
          type: Number,
          readOnly: true,
          notify: true,
          computed: '_calculateOffset(current,pageSize)'
        }
      },
      ready:function(){
      
      },
      prev: function() {
        if (this.current && this.current > 1)
          this.current -= 1;
      },
      next: function() {
        if (this.current && this.current < this.pageCount)
          this.current += 1;
      },
      _calculateOffset: function(current, pageSize) {
        return (current - 1) * pageSize;
      },
      _calculatePages: function(size, total, current_page) {
        function start_link($p, $g, $n) {
          $s = $p - Math.floor($n / 2);
          if ($s < 1) {
            return 1;
          }
          $max_s = $g - ($n - 1);
          if ($s > $max_s) {
            return $max_s;
          }
          return $s;
        }
        var totalPage = this.pageCount = Math.ceil(total / size);
        var result = [];
        var startRange = start_link(current_page, totalPage, this.rangeSize);
        var endRange = Math.min(totalPage, (startRange + this.rangeSize));
        for (i = 1; i <= totalPage; i++) {
          hidden = (i != 1 && i < startRange || i > endRange && i != this.pageCount);
          result.push({
            page: i,
            hidden: hidden
          });
        }
      return result;
    }
    
    
    });
  </script>
</dom-module>
