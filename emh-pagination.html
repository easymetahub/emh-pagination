<link rel="import" href="./bower_components/polymer/polymer.html"/>
<link rel="import" href="./bower_components/paper-menu/paper-menu.html"/>
<link rel="import" href="./bower_components/paper-item/paper-item.html"/>
<link rel="import" href="./bower_components/paper-button/paper-button.html"/>
<link rel="import" href="./bower_components/iron-icons/iron-icons.html"/>
<link rel="import" href="./bower_components/iron-icon/iron-icon.html"/>
<link rel="import" href="./bower_components/paper-icon-button/paper-icon-button.html"/>
<link rel="import" href="./bower_components/iron-flex-layout/iron-flex-layout.html"/>
        
<dom-module id="emh-pagination">
  <template>
    <style>
      :host {
        display: block;
        --paper-icon-button: { width: 64px; height: 64px; }
      }
      paper-item.emh-pagination {
        float: left;
      }
      paper-button.emh-pagination {
        float: left;
      }
      
    </style>
    <div class="container">
      <paper-menu selected="{{currentPage}}" selected-attribute="page" id="emh-pagination-row">
        <template is="dom-repeat" items="[[pages]]" restamp="true">
          <paper-item raised class="paper-pagination"  hidden$="[[item.hidden]]"  page="[[item.page]]">[[item.page]]</paper-item>
        </template>
        <template is="dom-if" if="{{showProperties}}">
          <div>
            <table style="background-color: lightgrey; width: 100%;">
              <thead>
                <tr>
                  <th>page-size</th>
                  <th>total</th>
                  <th>range-size</th>
                  <th>current-page</th>
                  <th>offset</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>{{pageSize}}</td>
                  <td>{{total}}</td>
                  <td>{{rangeSize}}</td>
                  <td>{{currentPage}}</td>
                  <td>{{offset}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </template>
      </paper-menu>
    </div>
  </template>

  <script>
    Polymer({

      is: 'emh-pagination',

      properties: {
        showProperties: {
          type: Boolean,
          value: false
        },
        pageSize: {
          type: Number
        },
        total: {
          type: Number
        },
        pages: {
          type: Array,
          readOnly: true,
          computed: '_calculatePages(pageSize,total,currentPage)'
        },
        rangeSize: {
          type: Number,
          value: 10
        },
        currentPage: {
          type: Number,
          value: 1,
          reflectToAttribute: true,
          notify: true
        },
        offset: {
          type: Number,
          readOnly: true,
          notify: true,
          computed: '_calculateOffset(currentPage,pageSize)'
        }
      },
      ready:function(){
      
      },
      pageOffest(page) {
        return (page - 1);
      },
      showFirst: function(index) {
        return index == 1;
      },
      showLast: function(index) {
        return index == this.pageCount;
      },
      _calculateOffset: function(currentPage, pageSize) {
        return currentPage * pageSize;
      },
      _calculatePages: function(size, total, current_page) {
        function start_link($p, $g, $n) {
          $s = $p - Math.floor($n / 2);
          if ($s < 1) {
            return 1;
          }
          $max_s = $g - ($n - 1);
          if ($s > $max_s) {
            return $max_s;
          }
          return $s;
        }
        var totalPage = this.pageCount = Math.ceil(total / size);
        var result = [];
        var startRange = start_link(current_page, totalPage, this.rangeSize);
        var endRange = Math.min(totalPage, (startRange + this.rangeSize));
        for (i = 0; i < totalPage; i++) {
          hidden = (i != 0 && i < startRange || i > endRange && i != (this.pageCount - 1));
          result.push({
            page: i,
            value: i,
            hidden: hidden
          });
        }
      return result;
    }
    
    
    });
  </script>
</dom-module>
